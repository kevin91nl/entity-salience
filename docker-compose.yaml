version: '3'

services:
  githook-installer:
    build:
      context: .
      dockerfile: Dockerfile.githooks
    volumes:
      - ./.git:/tmp/.git
      - ./hooks:/tmp/hooks

  base:
    image: entity-salience-base
    build:
      context: .
      dockerfile: Dockerfile.base

  lab:
    build:
      context: .
      dockerfile: Dockerfile.lab
    depends_on:
      - base
    stdin_open: true
    tty: true
    ports:
      - "8888:8888"
    command: sh -c "jupyter lab --no-browser --ip '*' --NotebookApp.token='' --allow-root --notebook-dir='/code/notebooks/'"
    volumes:
      - .:/code

  run-checks:
    build:
      context: .
      dockerfile: Dockerfile.checks
    depends_on:
      - base
    command: sh -c "make checks"
    volumes:
      - .:/code

  entity-salience:
    image: kevin91nl/entity-salience
    build:
      context: .
      dockerfile: Dockerfile
    stdin_open: true
    tty: true
    depends_on:
      - base
    command: sh -c "python"
    volumes:
      - .:/code
